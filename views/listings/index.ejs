<% layout("/layouts/boilerplate") %>

<body>
  <style>
    #filters {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter {
      text-align: center;
      margin-right: 2rem;
      margin-top: 2rem;
      opacity: 0.6;
      transition: opacity 0.2s ease;
    }

    .filter:hover {
      opacity: 1;
      cursor: pointer;
    }

    .filter p {
      font-size: 0.8rem;
    }

    .tax-info {
      display: none;
    }

    /* Modern Tax Toggle Switch */
    .tax-switch {
      margin-left: 3rem;
      margin-top: 1.1rem;
      background: #FF385C;
      border-radius: 2rem;
      padding: 1rem 1.5rem;
      box-shadow: 0 2px 8px rgba(255, 56, 92, 0.25);
      transition: all 0.3s ease;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .tax-switch:hover {
      background: #E31C5F;
      box-shadow: 0 4px 12px rgba(255, 56, 92, 0.35);
      /* transform: translateY(-2px); */
    }
/* 
    .tax-switch:active {
      transform: translateY(0);
    } */

    .tax-switch .form-check {
      margin: 0;
    }

    .tax-switch label {
      color: white;
      font-weight: 500;
      font-size: 0.9rem;
      cursor: pointer;
      margin: 0;
      margin-right: 1rem;
      user-select: none;
    }

    .tax-switch .form-check-input {
      width: 2.5rem;
      height: 1.3rem;
      cursor: pointer;
      background-color: rgba(255,255,255,0.3);
      border: none;
      transition: all 0.3s ease;
    }

    .tax-switch .form-check-input:checked {
      background-color: white;
      box-shadow: 0 0 5px rgba(255,255,255,0.8);
    }

    .tax-switch .form-check-input:focus {
      box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.3);
      border: none;
    }

    /* Like Button Styles */
    .card-img-overlay {
      opacity: 0;
      transition: opacity 0.3s ease;
      display: flex;
      justify-content: flex-end;
      align-items: flex-start;
      padding: 1rem;
      pointer-events: none;
    }

    .listing-card:hover .card-img-overlay {
      opacity: 1;
    }

    .like-btn {
      background: transparent;
      border: none;
      padding: 0;
      font-size: 1.5rem;
      color: white;
      pointer-events: auto;
      transition: transform 0.2s ease;
    }

    .like-btn:hover {
      transform: scale(1.1);
    }

    .like-btn i.liked {
      color: rgb(255, 56, 92);
      opacity: 1;
    }

    .like-btn i {
      filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.5));
    }
  </style>

  <div class="hero-section text-center mt-4 mb-5">
    <h1 class="display-4">Find your next "I never want to leave" spot.</h1>
    <p class="lead text-muted">
      From cozy corners to grand castles, we've got it all.
    </p>
  </div>

  <div id="filters">
    <div class="filter">
      <a href="/listings?category=Trending">
        <div><i class="fa-solid fa-fire"></i></div>
        <p>Trending</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Rooms">
        <div><i class="fa-solid fa-bed"></i></div>
        <p>Rooms</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Iconic-cities">
        <div><i class="fa-solid fa-mountain-city"></i></div>
        <p>Iconic cities</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Mountains">
        <div><i class="fa-solid fa-mountain"></i></div>
        <p>Mountains</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Castles">
        <div><i class="fa-brands fa-fort-awesome"></i></div>
        <p>Castles</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Amazing Pools">
        <div><i class="fa-solid fa-person-swimming"></i></div>
        <p>Amazing Pools</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Camping">
        <div><i class="fa-solid fa-campground"></i></div>
        <p>Camping</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Farm">
        <div><i class="fa-solid fa-cow"></i></div>
        <p>Farms</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Arctic">
        <div><i class="fa-solid fa-snowflake"></i></div>
        <p>Arctic</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Domes">
        <div><i class="fa-solid fa-igloo"></i></div>
        <p>Domes</p>
      </a>
    </div>
    <div class="filter">
      <a href="/listings?category=Boats">
        <div><i class="fa-solid fa-sailboat"></i></div>
        <p>Boats</p>
      </a>
    </div>

    <div class="tax-switch">
      <div class="form-check form-switch form-check-reverse">
        <label class="form-check-label" for="flexSwitchCheckDefault"
          >Display total after taxes</label
        >
        <input
          class="form-check-input"
          type="checkbox"
          role="switch"
          id="flexSwitchCheckDefault"
        />
      </div>
    </div>
  </div>

  <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 listing-link mt-3">
    <% for(let listing of allListings){ %>
    <div class="card col listing-card">
      <div style="position: relative">
        <a href="/listings/<%= listing._id%>">
          <img
            src="<%= listing.image.url %>"
            class="card-img-top"
            alt="Listing_image"
            style="height: 20rem"
          />
        </a>
        <div class="card-img-overlay">
          <form
            action="/listings/<%= listing._id %>/like"
            method="POST"
            style="z-index: 10"
          >
            <button type="submit" class="like-btn">
              <% if (currUser && listing.likes &&
              listing.likes.includes(currUser._id)) { %>
              <i class="fa-solid fa-heart liked"></i>
              <% } else { %>
              <i class="fa-regular fa-heart"></i>
              <% } %>
            </button>
          </form>
        </div>
      </div>
      <div class="card-body">
        <p class="card-text">
          <a
            href="/listings/<%= listing._id%>"
            class="listing-link-text"
            style="text-decoration: none; color: inherit"
          >
            <b> <%= listing.title %> </b><br />
            &#8377; <%= listing.price ? listing.price.toLocaleString("en-IN") :
            0 %> /night
            <i class="tax-info"> &nbsp; &nbsp; +18% GST</i>
          </a>
        </p>
      </div>
    </div>
    <% } %>
  </div>

  <script>
    let taxSwitch = document.getElementById("flexSwitchCheckDefault");
    taxSwitch.addEventListener("click", () => {
      let taxInfo = document.getElementsByClassName("tax-info");

      for (info of taxInfo) {
        if (info.style.display != "inline") {
          info.style.display = "inline";
        } else {
          info.style.display = "none";
        }
      }
    });
  </script>
</body>
